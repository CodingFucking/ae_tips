# 15. Парсинг Таблицы Менделеева

![https://miro.medium.com/v2/resize:fit:1400/1*0ee_djNLZf5-q9qmCC84Kw.png](https://miro.medium.com/v2/resize:fit:1400/1*0ee_djNLZf5-q9qmCC84Kw.png)

Привет, пришла идея создать стикеры для Телеграм с элементами Таблицы. Количество элементов идеально подходит под ограничения количества стикеров в паке, плюс хватит на легенду и закрывашку. Но делать руками каждый из 118 элементов я, конечно же, не буду. Что в итоге и стало поводом для этого поста.

## **Задача**

**С**оздать композицию в AE, которая будет парсить нужные ячейки из импортированной таблицы.

## **Подготовка**

![https://miro.medium.com/v2/resize:fit:1400/1*RRcI3VqkAPBrfpG5mxQ8sA.png](https://miro.medium.com/v2/resize:fit:1400/1*RRcI3VqkAPBrfpG5mxQ8sA.png)

Накидываю макет вёрстки в фотошопе.

![https://miro.medium.com/v2/resize:fit:1400/1*AFeZGEfYaAgFLOfv-DgpLQ.png](https://miro.medium.com/v2/resize:fit:1400/1*AFeZGEfYaAgFLOfv-DgpLQ.png)

Подготавливаю таблицу в экселе с нужными для меня столбцами.

- Сразу привожу всё к единому имени: название слоёв в пээсдэ идентично с названием столбцов в экселе.
- Эксельку импортим в текст и затаскиваем всё в афтер.
- Создадим композицию для импортированной таблицы, чтобы брать из неё значения, назовём её “_data”.

![https://miro.medium.com/v2/resize:fit:1400/1*JNf5DXQxI1_YUR9GyEWAkQ.png](https://miro.medium.com/v2/resize:fit:1400/1*JNf5DXQxI1_YUR9GyEWAkQ.png)

Фотошопные текстовые слои засовываем в композицию “icon_1”, конвертим в редактируемый текст и начинаем прописывать выражения.

Для слоя sign следующее выражение:

```jsx
//берём значения без форматирования
//вкратце чё тут происходит

//тут берём число из названия композиции,
//которое идёт после нижнего подчеркивания и вычитаем 1
num = parseInt(thisComp.name.split("_")[1]) - 1;

//тута берём названия текущего слоя
name = thisLayer.name;

//ну и выдаём что нужно
//нам нужна эта строка
//comp("_data").layer("period.txt")("Data")("Outline")("sign")("sign 0")
//но мы естесна не будем перебивать и названия и значения руками
//идём в композицию с таблицей
//обращаемся с нужному столбцу
comp("_data").layer("period.txt")("Data")("Outline")(name)(name + " " + num)
```

```jsx
//берём значения без форматирования
num = parseInt(thisComp.name.split("_")[1]) - 1;
name = thisLayer.name;
comp("_data").layer("period.txt")("Data")("Outline")(name)(name + " " + num)
```

То же самое вставляем в id и groupPeriod.

Для lname нужно подрезать запятой в случае двух названий:

```jsx
//берём значения и режем по запятой
num = parseInt(thisComp.name.split("_")[1]) - 1;
name = thisLayer.name;
res = comp("_data").layer("period.txt")("Data")("Outline")(name)(name + " " + num);
res.split(",")[0]
```

Ой, тут атомная масса подъехала, и я её не буду упрощать, так как это и так работает)):

```jsx
//берём стороку, режем по пробелу, меняем запятую на точку
num = parseInt(thisComp.name.split("_")[1]) - 1;
name = thisLayer.name;
string = comp("_data").layer("period.txt")("Data")("Outline")(name)(name + " " + num);
res1 = string.split(" ")[0].replace(",", ".");

//проверим на наличие скобки (только для последних 34 элементов)
string2 = string.search(/\[/);
if ((Number(string2) + 1) == 1 ){
 string3 = string.split("[")[1];
 res2 = string3.replace(",", ".");
} else res2 = "";

//проверяем на число и выдаём с плавающей точкой значение,
//округляя до 2 знаков после запятой, выбирая между res1 и res2
!isNaN(parseFloat(res1)) ? parseFloat(res1).toFixed(2).replace(".", ",") : "[" + parseFloat(res2).toFixed(2).replace(".", ",") + "]";
```

Да, слишком сложно, можно было в экселе подрезать теми же регулярками, но здесь суть не в простоте проверки, а в оптимизации количества работы)).

На этом и всё, дальше дублируем композицию “icon_1” 117 раз. Но без танцев с бубном всё равно не обошлось. Для того, чтобы зарендорить всё пээнгэхами, я пользовался **rd: Render Layers**, без него никак, не знаю, только у меня так или у всех, но он теряет расширения файлов, и поэтому я ещё коммендером это правил.

Ну а следующий этап заливки в Телегу я уже не смог обойти и заливал каждый стикер поодиночке, присваивая ему эмодзи.

[https://t.me/addstickers/PeriodicTableOfIcon](https://t.me/addstickers/PeriodicTableOfIcon)

## **Итог**

Не отчаивайтесь, когда сваливается рутина, ищите как это решить программно, потому что кто его знает, сколько будет правок после проделанной однотипной руками работы, а так бац – исправил реф, и всё парой кликов обновится.

Если вам интересны подобные фишки, то подписывайтесь на https://t.me/ae_tips
